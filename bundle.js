!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s=class{static getInstance(){return this._instance||(this._instance=new this),this._instance}static deleteInstance(){delete this._instance}};class n{}n.FirstLetterLower=function(t){return t.substring(0,1).toLowerCase()+t.substring(1,t.length).toLowerCase()},n.BindIntHandler=function(t,e){var i=n.FirstLetterLower(e);t.prototype._getInt=function(t){return Math.floor(this[t])},t.prototype._setInt=function(t,e){"number"==typeof e&&(this[t]=Math.floor(e))},t.prototype._tranInt=function(t,e){"number"==typeof e&&(this[t]=Math.floor(this[t]+e))},t.prototype._multiplyInt=function(t,e){"number"==typeof e&&(this[t]=Math.floor(this[t]*e))},t.prototype._dividedInt=function(t,e){"number"==typeof e&&(this[t]=Math.floor(this[t]/e))},t.prototype["get"+e]=function(){return this._getInt(i)},t.prototype["set"+e]=function(t){return this._setInt(i,t)},t.prototype["tran"+e]=function(t){return this._tranInt(i,t)}},n.BindDirtyIntHandler=function(t,e){var i=n.FirstLetterLower(e),s="is"+[e]+"Dirty";t.prototype._getInt=function(t){return Math.floor(this[t])},t.prototype._setInt=function(t,e){"number"==typeof e&&e!==this[t]&&(this[s]=!0,this[t]=Math.floor(e))},t.prototype._tranInt=function(t,e){"number"==typeof e&&e!==this[t]&&(this[s]=!0,this[t]=Math.floor(this[t]+e))},t.prototype._multiplyInt=function(t,e){"number"==typeof e&&e!==this[t]&&(this[s]=!0,this[t]=Math.floor(this[t]*e))},t.prototype._dividedInt=function(t,e){"number"==typeof e&&e!==this[t]&&(this[s]=!0,this[t]=Math.floor(this[t]/e))},t.prototype["get"+e]=t.prototype["get"+e]||function(){return this._getInt(i)},t.prototype["set"+e]=t.prototype["set"+e]||function(t){return this._setInt(i,t)},t.prototype["tran"+e]=t.prototype["tran"+e]||function(t){return this._tranInt(i,t)},t.prototype["_done"+e+"Dirty"]=t.prototype["_done"+e+"Dirty"]||function(){this[s]=!1}},n.BindNumberHandler=function(t,e){var i=n.FirstLetterLower(e);t.prototype._getNumber=function(t){return this[t]},t.prototype._setNumber=function(t,e){"number"==typeof e&&(this[t]=e)},t.prototype._tranNumber=function(t,e){"number"==typeof e&&(this[t]+=e)},t.prototype._multiplyNumber=function(t,e){"number"==typeof e&&(this[t]*=e)},t.prototype._dividedNumber=function(t,e){"number"==typeof e&&(this[t]/=e)},t.prototype["get"+e]=function(){return this._getNumber(i)},t.prototype["set"+e]=function(t){return this._setNumber(i,t)},t.prototype["tran"+e]=function(t){return this._tranNumber(i,t)}},n.BindDirtyNumberHandler=function(t,e){var i=n.FirstLetterLower(e),s="is"+[e]+"Dirty";t.prototype._getNumber=function(t){return this[t]},t.prototype._setNumber=function(t,e){"number"==typeof e&&e!==this[t]&&(this[s]=!0,this[t]=e)},t.prototype._tranNumber=function(t,e){"number"==typeof e&&e!==this[t]&&(this[s]=!0,this[t]+=e)},t.prototype._multiplyNumber=function(t,e){"number"==typeof e&&e!==this[t]&&(this[s]=!0,this[t]*=e)},t.prototype._dividedNumber=function(t,e){"number"==typeof e&&e!==this[t]&&(this[s]=!0,this[t]/=e)},t.prototype["get"+e]=function(){return this._getNumber(i)},t.prototype["set"+e]=function(t){return this._setNumber(i,t)},t.prototype["tran"+e]=function(t){return this._tranNumber(i,t)},t.prototype["_done"+e+"Dirty"]=function(){this[s]=!1}},n.BindBoolHandler=function(t,e){var i=n.FirstLetterLower(e);t.prototype["get"+e]=function(){return!!this[i]},t.prototype["set"+e]=function(t){this[i]=!!t},t.prototype["toggle"+e]=function(t){this[i]=!t}},n.BindDirtyBoolHandler=function(t,e){var i=n.FirstLetterLower(e),s="is"+[e]+"Dirty";t.prototype["get"+e]=t.prototype["get"+e]||function(){return!!this[i]},t.prototype["set"+e]=t.prototype["set"+e]||function(t){this[s]=!0,this[i]=!!t},t.prototype["toggle"+e]=t.prototype["toggle"+e]||function(t){this[s]=!0,this[i]=!t},t.prototype["_done"+e+"Dirty"]=t.prototype["_done"+e+"Dirty"]||function(){this[s]=!1}};class o extends n{constructor(t,e){super(),this.setX(t),this.setY(e)}getXY(){return{x:this.x,y:this.y}}setXY(t,e){this._setNumber("x",t),this._setNumber("y",e)}tranXY(t,e){this._tranNumber("x",t),this._tranNumber("y",e)}assigned(t){t instanceof o&&(this.x=t.x,this.y=t.y)}copy(){return new o(this.x,this.y)}tran(){v instanceof o&&this.tranXY(v.x,v.y)}multiply(t){this.multiplyXY(t,t)}multiplyXY(t,e){this._multiplyNumber("x",t),this._multiplyNumber("y",e)}}n.BindNumberHandler(o,"X"),n.BindNumberHandler(o,"Y"),o.BindAllHandler=function(t,e,i){var s=n.FirstLetterLower(e),o="is"+[e]+"Dirty";i&&(e=""),t.prototype["get"+e+"X"]=function(){return this[s].getX()},t.prototype["set"+e+"X"]=function(t){return this[o]=!0,this[s].setX(t)},t.prototype["tran"+e+"X"]=function(t){return this[o]=!0,this[s].tranX(t)},t.prototype["get"+e+"Y"]=function(){return this[s].getY()},t.prototype["set"+e+"Y"]=function(t){return this[o]=!0,this[s].setY(t)},t.prototype["tran"+e+"Y"]=function(t){return this[o]=!0,this[s].tranY(t)},t.prototype["get"+e+"XY"]=function(){return this[s].getXY()},t.prototype["set"+e+"XY"]=function(t,e){return this[o]=!0,this[s].setXY(t,e)},t.prototype["tran"+e+"XY"]=function(t,e){return this[o]=!0,this[s].tranXY(t,e)},t.prototype["get"+e]=function(){return this[s].copy()},t.prototype["set"+e]=function(t){return this[o]=!0,this[s].assigned(t)},t.prototype["tran"+e]=function(t){return this[o]=!0,this[s].tran(t)},t.prototype["_done"+e+"Dirty"]=function(){this[o]=!1}};class r extends n{constructor(t,e){super(),this.setWidth(t),this.tranWidth(e)}getWH(){return{width:this.width,height:this.height}}setWH(t,e){this._setNumber("width",t),this._setNumber("height",e)}tranWH(t,e){this._tranNumber("width",t),this._tranNumber("height",e)}assigned(t){t instanceof r&&(this.width=t.width,this.height=t.height)}copy(){return new r(this.width,this.height)}tran(){v instanceof r&&this.tranWH(v.width,v.height)}}n.BindNumberHandler(r,"Width"),n.BindNumberHandler(r,"Height"),r.BindMemberHandler=function(t,e,i){var s=n.FirstLetterLower(e),o="is"+[e]+"Dirty";i&&(e=""),t.prototype["get"+e+"Width"]=function(){return this[s].getWidth()},t.prototype["set"+e+"Width"]=function(t){return this[o]=!0,this[s].setWidth(t)},t.prototype["tran"+e+"Width"]=function(t){return this[o]=!0,this[s].tranWidth(t)},t.prototype["get"+e+"Height"]=function(){return this[s].getHeight()},t.prototype["set"+e+"Height"]=function(t){return this[o]=!0,this[s].setHeight(t)},t.prototype["tran"+e+"Height"]=function(t){return this[o]=!0,this[s].tranHeight(t)},t.prototype["_done"+e+"Dirty"]=function(){this[o]=!1}},r.BindWHHandle=function(t,e,i){var s=n.FirstLetterLower(e),o="is"+[e]+"Dirty";i&&(e=""),t.prototype["get"+e+"WH"]=function(){return this[s].getWH()},t.prototype["set"+e+"WH"]=function(t,e){return this[o]=!0,this[s].setWH(t,e)},t.prototype["tran"+e+"WH"]=function(t,e){return this[o]=!0,this[s].tranWH(t,e)},t.prototype["_done"+e+"Dirty"]=function(){this[o]=!1}},r.BindClassHandle=function(t,e,i){var s=n.FirstLetterLower(e),o="is"+[e]+"Dirty";i&&(e=""),t.prototype["get"+e]=function(){return this[s].copy()},t.prototype["set"+e]=function(t){return this[o]=!0,this[s].assigned(t)},t.prototype["tran"+e]=function(t){return this[o]=!0,this[s].tran(t)},t.prototype["_done"+e+"Dirty"]=function(){this[o]=!1}},r.BindAllHandler=function(t,e,i){r.BindMemberHandler(t,e,i),r.BindClassHandle(t,e,i),r.BindClassHandle(t,e,i)};class h extends n{constructor(){super(),this.children=[],this.components=[],this.actions=[],this.level=0,this.parent=null,this.position=new o(0,0),this.anchor=new o(.5,.5),this.size=new r(0,0),this.scale=new o(1,1),this.rotation=0,this.enable=!1,this.visible=1}_onAdded(){this.hasAdded=!0,this.mountAllComponent(),this.setEnable(!0),this.onAdded&&this.onAdded()}_onRemoved(){this.hasAdded=!1,this.removeAllComponents(),this.onRemoved&&this.onRemoved()}_onDisable(){for(var t in this.onDisable&&this.onDisable(),this.components)this.components[t].setEnable(!1);for(var t in this.children)this.children[t].setEnable(!1)}_onEnable(){for(var t in this.onEnable&&this.onEnable(),this.components)this.components[t].setEnable(!0);for(var t in this.children)this.children[t].setEnable(!0)}setEnable(t){if(this.enable===!!t)return!0;this.enable=!!t,this.enable?this._onEnable():this._onDisable()}getAnchorOffset(){return{x:this.anchor.x*this.size.width,y:this.anchor.y*this.size.height}}addChild(t){return t.getParent()?console.warn("has been added !"):(this.children.push(t),t.parent=this,t.setLevel(this.level+1),t._onAdded(),t)}mountAllComponent(){this.components.map(t=>t.setNode(this))}removeChild(t){for(var e=0;e<this.children.length;++e)if(this.children[e]==t)return void this.children.splice(e,1).onRemoved()}getParent(){return this.parent}addComponent(t){return this.components.push(t),this.hasAdded&&t.setNode(this),t}removeComponent(t){for(var e=0;e<this.components.length;++e)if(this.components[e]==t)return this.components.splice(e,1),void(t.hasMounted()&&t._onUnmount())}removeAllComponents(){for(var t=0;t<this.components.length;++t)this.components[t].hasMounted()&&this.components[t]._onUnmount()}addAction(t){return this.actions.push(t),t.setNode(this),t}removeAction(t){for(var e=0;e<this.actions.length;++e)if(this.actions[e]==t)return void this.actions.splice(e,1)}removeAllActions(){this.actions=[]}update(t){this.enable&&(this.onUpdate&&this.onUpdate(t),this.actions.map(e=>e.update(t)),this.components.map(e=>e.update(t)),this.children.map(e=>e.update(t)))}draw(t){this.visible&&(t.translate(this.position.x,this.position.y),t.rotate(this.rotation*Math.PI/180),t.scale(this.scale.x,this.scale.y),t.save(),this.components.map(e=>{e.draw(t),t.restore(),t.save()}),this.children.map(e=>{e.draw(t),t.restore(),t.save()}),t.restore(),this._doneTransformsDirty(),this._doneLevelDirty(),this._doneEnableDirty())}isTransformsDirty(){return this.isPositionDirty||this.isScaleDirty||this.isRotationDirty||this.isSizeDirty}_doneTransformsDirty(){this._donePositionDirty(),this._doneScaleDirty(),this._doneAnchorDirty(),this._doneSizeDirty()}debugDraw(t){}}o.BindAllHandler(h,"Position"),o.BindAllHandler(h,"Scale"),o.BindAllHandler(h,"Anchor"),r.BindMemberHandler(h,"Size",!0),r.BindWHHandle(h,"Size"),r.BindClassHandle(h,"Size"),n.BindDirtyIntHandler(h,"Level"),n.BindDirtyNumberHandler(h,"Rotation"),n.BindDirtyBoolHandler(h,"Enable"),n.BindDirtyBoolHandler(h,"Visible");class a extends h{static getInstance(){return this.instance||(this.instance=new a),this.instance}constructor(){super(),this.curIndex=0,this.enable=!0}run(t){this.addChild(t)}push(t){this.children[this.curIndex].setEnable(!1),this.children[this.curIndex].setVisible(!1),++this.curIndex,this.addChild(t)}back(){}}const c=function(t){return"[object Array]"===function(t){return Object.prototype.toString.call(t)}(t)},u=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=e.createSVGMatrix(),s=[];t.getTransform=function(){return i};var n=t.save;t.save=function(){return s.push(i.translate(0,0)),n.call(t)};var o=t.restore;t.restore=function(){return i=s.pop(),o.call(t)};var r=t.scale;t.scale=function(e,s){return i=i.scaleNonUniform(e,s),r.call(t,e,s)};var h=t.rotate;t.rotate=function(e){return i=i.rotate(e),h.call(t,e)};var a=t.translate;t.translate=function(e,s){return i=i.translate(e,s),a.call(t,e,s)};var c=t.transform;t.transform=function(s,n,o,r,h,a){var u=e.createSVGMatrix();return u.a=s,u.b=n,u.c=o,u.d=r,u.e=h,u.f=a,i=i.multiply(u),c.call(t,s,n,o,r,h,a)};var u=t.setTransform;t.setTransform=function(e,s,n,o,r,h){return i.a=e,i.b=s,i.c=n,i.d=o,i.e=r,i.f=h,u.call(t,e,s,n,o,r,h)};var l=e.createSVGPoint();t.transformedPoint=function(t,e){return l.x=t,l.y=e,l.matrixTransform(i.inverse())};var d=e.createSVGPoint();t.transformedPoint2=function(t,e){return d.x=t,d.y=e,d.matrixTransform(i)};var p=t.clearRect;t.clearRect=function(e,i,s,n){t.save(),t.setTransform(1,0,0,1,0,0),p.call(t,e,i,s,n),t.restore()}};class l extends s{constructor(){super(),this.lastUpdateTime=0,this.rootNode=a.getInstance()}getSize(){return{width:this.canvas.width,height:this.canvas.height}}setSize(t,e){return this.canvas.width=t,this.canvas.height=e,this}setBackgroundColor(t="gray"){return this.backgroundColor=t,this}launch(t){return this.canvas=t,this.setSize(800,600),this.ctx=this.canvas.getContext("2d"),this.ctxTracker=u(this.ctx),this.looper(0),this}looper(t){this.update(t-this.lastUpdateTime),this.draw(),this.lastUpdateTime=t,window.requestAnimationFrame(this.looper.bind(this))}update(t){this.rootNode.update(t)}draw(){var t=this.ctx;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle=this.backgroundColor,t.fillRect(0,0,this.canvas.width,this.canvas.height),this.rootNode.draw(t)}}class d{constructor(t,e,i){this.name=t,this.func=e,this.priority=i}setEventCenter(t){this.eventCenter=t}removeSelf(){this.eventCenter&&this.eventCenter.removeListener(this)}}class p extends s{constructor(){super(),this.listeners={}}dispatch(t,e){var i=this.getListeners(t);for(var s in i)if(i[s].func(e))break}getListeners(t){return this.listeners[t]}addListener(t,e,i){var s=this.listeners[t]||[];if(s){var n=new d(t,e,i);return n.setEventCenter(this),s.push(n),s.sort((t,e)=>e.priority-t.priority),this.listeners[t]=s,n}}removeListener(t){for(var e=this.getListeners(t.name),i=0;i<e.length;++i)if(e[i]===t){e.splice(i,1);break}}update(t){this.opUpdate&&this.opUpdate(t)}}class y extends p{constructor(){super()}launch(){document.addEventListener("keydown",this.onKeyDown.bind(this),!1),document.addEventListener("keyup",this.onKeyUp.bind(this),!1)}onKeyDown(t){this.dispatch("keydown",t)}onKeyUp(t){this.dispatch("keyup",t)}onUpdate(t){}}class m extends p{constructor(){super()}launch(){document.addEventListener("mousedown",this.onMouseDown.bind(this),!1),document.addEventListener("mouseup",this.onMouseUp.bind(this),!1),document.addEventListener("mousemove",this.onMouseMove.bind(this),!1)}onMouseDown(t){this.dispatch("mousedown",t)}onMouseUp(t){this.dispatch("mouseup",t)}onMouseMove(t){this.dispatch("mousemove",t)}}class g{onAssign(){}onFinish(){}setNode(t){this.node=t,this.onAssign()}update(){}}class f extends g{constructor(t,e){super(),this.value=t,this.duration=e,this.time=e}onAssign(){this.endValue=this.node.getRotation()+this.value,this.speed=this.value/this.duration}onFinish(){this.node.setRotation(this.endValue),this.node.removeAction(this)}update(t){var e=this.node.getRotation();this.node.setRotation(e+this.speed*t),this.time-=t,this.time<=0&&this.onFinish()}}class w{constructor(){this.enable=!0}_onMount(){this.onMount&&this.onMount()}_onUnmount(){this.onUnmount&&this.onUnmount()}_onDisable(){this.onDisable&&this.onDisable()}_onEnable(){this.onEnable&&this.onEnable()}setEnable(t){if(this.enable===!!t)return!0;this.enable=!!t,this.enable?this._onEnable():this._onDisable()}hasMounted(){return!!this.node}setNode(t){return t?this.node?console.warn("FI_Component","Component has been mounted!"):(this.node=t,void this._onMount()):console.warn("FI_Component","can not mount on invaild node! node:",t)}getNode(){return this.node}update(){}draw(){}debugDraw(){}}var b=new class{constructor(){this.images={}}firstLoadImage(t){return new Promise((e,i)=>{var s=new Image;s.src=t,s.onload=(()=>{for(var i in this.images[t])this.images[t][i].onload(s);return this.images[t]=s,e(s)}),s.onerror=(e=>{for(var s in this.images[t])this.images[t][s].onerror(e);return delete this.images[t],i(e)})})}loadImage(t){return new Promise((e,i)=>{this.images[t].push({onload:e,onerror:i})})}getImage(t){var e=this.images[t];return e?c(e)?this.loadImage(t):Promise.resolve(e):(this.images[t]=[],this.firstLoadImage(t))}};class x extends w{constructor(t){super(),this.imageUri=t,this.texRect=null,this.scale=new o(1,1),this.flap=new o(1,1)}setScale(t){this.scale=t}setFlap(t){this.flap=t}onMount(){this.loadImage(this.imageUri)}async loadImage(t){try{this.image=await b.getImage(t),this.texRect=this.texRect||{x:0,y:0,width:this.image.width,height:this.image.height}}catch(t){console.warn(t)}}setTexRect(t,e,i,s){this.texRect={x:t,y:e,width:i,height:s}}draw(t){if(this.image&&this.texRect){var e=this.node.getAnchorOffset();t.scale(this.scale.x*this.flap.x,this.scale.y*this.flap.y),t.drawImage(this.image,this.texRect.x,this.texRect.y,this.texRect.width,this.texRect.height,-e.x,-e.y,this.node.size.width,this.node.size.height)}}}class M extends w{constructor(){super(),this.scale=new o(1,1),this.flap=new o(1,1)}setScale(t){this.scale=t,this.image&&this.image.setScale(t)}setFlap(t){this.flap=t,this.image&&this.image.setFlap(t)}init(t,e,i){this.setDuration(e),this.setImage(t),this.setTexRect(i)}setImage(t){this.image=t,this.hasMounted()&&t&&t.setNode(this.getNode())}setDuration(t){this.duration=t}getDuration(){return this.duration}setTexRect(t){this.texRect=t}onMount(){this.image&&!this.image.hasMounted()&&this.image.setNode(this.getNode())}update(t){}draw(t){this.image&&(this.texRect&&this.image.setTexRect(this.texRect.x,this.texRect.y,this.texRect.width,this.texRect.height),this.image.draw(t))}}class _ extends w{constructor(){super(),this.frames=[],this.curIndex=0,this.curTime=0,this.isAutoReset=!0,this.loop=0,this.curLoop=0,this.scale=new o(1,1),this.flap=new o(1,1)}setScale(t){this.scale=t,this.curFrame&&this.curFrame.setScale(t)}setFlap(t){this.flap=t,this.curFrame&&this.curFrame.setFlap(t)}addFrame(t){this.frames.push(t),this.hasMounted()&&t.setNode(this.node)}onMount(){this.frames.map(t=>{t.setNode(this.getNode())})}play(){this.playing=!0}stop(){this.playing=!1}setAutoReset(t){this.isAutoReset=t}setLoop(t){this.loop=t}onLoopFinish(){}onFinish(){}update(t){if(this.playing){var e=this.frames[this.curIndex];if(e)if(this.curTime+=t,e.update(t),this.curTime-e.getDuration()>=0){this.curTime=0;var i=this.curIndex+1;i>=this.frames.length&&(0==this.loop?i=0:this.curLoop>=this.loop?(this.curLoop+=1,i=0):(i=this.frames.length-1,this.stop())),i!==this.curIndex&&(this.curIndex=i,this.curFrame=this.frames[i],this.curFrame.setScale(this.scale),this.curFrame.setFlap(this.flap))}}}draw(t){this.curFrame&&this.curFrame.draw(t)}}var S=new class{constructor(){this.imagesCache={}}getImage(t){return this.imagesCache[t]||(this.imagesCache[t]=new x(t)),this.imagesCache[t]}createWithData(t){var e=new _;return t.frames.map((i,s)=>{var n=new M;n.init(this.getImage(i.image||t.image),i.duration||t.duration,i.rect),e.addFrame(n)}),e.setLoop(t.loop),e}};class A extends w{constructor(){super(),this.jumpable=!1,this.walkDirection=0,this.jumpSpeed=0,this.walkSpeed=0,this.walkAcc=0,this.gavity=0,this.ground=0}jump(){this.jumpable&&this.mover.setVelocityY(this.jumpSpeed)}walk(t){this.walkDirection=t?t/Math.abs(t):0}setJumpSpeed(t){this.jumpSpeed=t}setWalkSpeed(t){this.walkSpeed=Math.abs(t)}setWalkAcc(t){this.walkAcc=Math.abs(t)}setGavity(t){this.gavity=t}setGround(t){this.ground=t}setMover(t){this.mover=t}setRect(t){this.rect=t}onMount(){this.mover&&this.mover.setNode(this.getNode())}update(t){if(this.mover){this.mover.update(t);var e=this.node.getPositionY(),i=0;e<this.ground&&(i=this.mover.tranVelocityY(this.gavity)*t/1e3,this.jumpable=!1),e+i>this.ground&&(this.node.setPositionY(this.ground),this.mover.setVelocityY(0),this.jumpable=!0);var s=this.walkDirection,n=this.walkSpeed,o=this.walkAcc;if(n&&o)if(s){var r=this.mover.getVelocityX();this.mover.tranVelocityX(s*(o-Math.abs(r*o/n))),(s>0&&r<0||s<0&&r>0)&&this.mover.decayVelocityX(o)}else this.mover.decayVelocityX(o)}}}class D extends w{constructor(t){super(),this.content="Hello",this.anchor=new o(0,.5),this.fontSize=24,this.fontSizeUnit="px",this.fontFamily="Arial",this.textAlign="center",this.fillStyle="white",this.strokeStyle="gray",this.offset=new o(0,0),this.size=new r(0,this.fontSize)}onMount(){}_onSizeChange(t,e){this.setSizeWH(t,e),this.onSizeChange&&this.onSizeChange(this)}draw(t){t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.font=this.fontSize+this.fontSizeUnit+" "+this.fontFamily,t.textAlign=this.textAlign;var e=t.measureText(this.content);e.width==this.size.width&&e.height==this.size.height||this._onSizeChange(e.width,this.fontSize),this.fillStyle&&t.fillText(this.content,this.offset.x+this.anchor.x*this.size.width,this.offset.y+this.anchor.y*this.size.height),this.strokeStyle&&t.strokeText(this.content,this.offset.x+this.anchor.x*this.size.width,this.offset.y+this.anchor.y*this.size.height)}}o.BindAllHandler(D,"Offset"),r.BindMemberHandler(D,"Size",!0),r.BindWHHandle(D,"Size"),r.BindClassHandle(D,"Size");class I extends w{onMount(){this.mousedownListener=m.getInstance().addListener("mousedown",this._onGlobalMouseDown.bind(this),this.node.getLevel()),this.mouseupListener=m.getInstance().addListener("mouseup",this._onGlobalMouseUp.bind(this),this.node.getLevel()),this.mousemoveListener=m.getInstance().addListener("mousemove",this._onGlobalMouseMove.bind(this),this.node.getLevel())}onUnmount(){this.mousedownListener.removeSelf(),this.mouseupListener.removeSelf(),this.mousemoveListener.removeSelf()}_getCurrentIsMouseOnMe(t){if(!t)return!1;var e=this.node.getAnchorOffset(),i=this.transform.e-e.x*this.node.scale.x,s=i+this.node.size.width*this.node.scale.x,n=this.transform.f-e.y*this.node.scale.y,o=n+this.node.size.height*this.node.scale.y;return this.mousePosition={x:-this.transform.e+t.clientX,y:-this.transform.f+t.clientY},t.clientX>=i&&t.clientX<=s&&t.clientY>=n&&t.clientY<=o}_onGlobalMouseMove(t){t&&(this._getCurrentIsMouseOnMe(t)?(!this.isMouseOnMe&&this.onMouseOut&&this.onMouseIn(this.mousePosition),this.isMouseOnMe=!0,this._onMouseMove(t)):(this.isMouseOnMe&&this.onMouseOut&&this.onMouseOut(this.mousePosition),this.isMouseOnMe=!1))}_onMouseMove(t){this.enable&&this.onMouseMove&&this.onMouseMove(this.mousePosition)}_onGlobalMouseDown(t){var e=this._getCurrentIsMouseOnMe(t);this.enable&&e&&this.onMouseDown&&this.onMouseDown(this.mousePosition)}_onGlobalMouseUp(t){var e=this._getCurrentIsMouseOnMe(t);this.enable&&e&&this.onMouseUp&&this.onMouseUp(this.mousePosition)}draw(t){this.debugDraw(t),this.transform=t.getTransform()}}class k extends g{constructor(t,e,i){super(),this.valueX=t,this.valueY=e,this.duration=i,this.time=i}onAssign(){this.speedX=(this.valueX-this.node.getScaleX())/this.duration,this.speedY=(this.valueY-this.node.getScaleY())/this.duration}onFinish(){this.node.setScaleX(this.valueX),this.node.setScaleY(this.valueY),this.node.removeAction(this)}update(t){this.node.tranScaleX(this.speedX*t),this.node.tranScaleY(this.speedY*t),this.time-=t,this.time<=0&&this.onFinish()}}class L extends h{constructor(t){super(),this.textContent=t}onAdded(){var t=this.addChild(new h),e=t.addChild(new h).addComponent(new D);e.content=this.textContent,e.onSizeChange=(t=>{this.size.width=t.size.width,this.size.height=t.size.height});var i=this.addComponent(new I);i.onMouseIn=(e=>{t.removeAllActions(),t.addAction(new k(1.1,1.1,250)),this.onMouseIn&&this.onMouseIn()}),i.onMouseOut=(e=>{t.removeAllActions(),t.addAction(new k(1,1,250)),this.onMouseOut&&this.onMouseOut()}),i.onMouseDown=(e=>{t.removeAllActions(),t.addAction(new k(1,1,50)),this.onMouseDown&&this.onMouseDown()}),i.onMouseUp=(e=>{t.removeAllActions(),t.addAction(new k(1.1,1.1,50)),this.onMouseUp&&this.onMouseUp()})}}class C{static intersectWith(t,e){var i=Math.max(t.x,e.x),s=Math.min(t.x+t.w,e.x+e.w)-i;if(s<0)return null;var n=Math.max(t.y,e.y),o=Math.min(t.y+t.h,e.y+e.h)-n;return o<0?null:new C(i,n,s,o)}constructor(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}intersectWith(t){return C.intersectWith(this,t)}}class H extends w{constructor(){super(),this.velocity=new o(0,0)}getVelocity(){return this.velocity}setVelocity(t,e){this.velocity=new o(t,e)}tranVelocity(t,e){return this.velocity.x+=t,this.velocity.y+=e,this.velocity}getVelocityX(){return this.velocity.x}setVelocityX(t){return this.velocity.x=t,this.velocity.x}tranVelocityX(t){return this.velocity.x+=t,this.velocity.x}decayVelocityX(t){this.velocity.x>0?(this.velocity.x-=Math.abs(t),this.velocity.x=Math.max(0,this.velocity.x)):this.velocity.x<0&&(this.velocity.x+=Math.abs(t),this.velocity.x=Math.min(0,this.velocity.x))}getVelocityY(){return this.velocity.y}setVelocityY(t){return this.velocity.y=t,this.velocity.y}tranVelocityY(t){return this.velocity.y+=t,this.velocity.y}decayVelocityY(t){this.velocity.y>0?(this.velocity.y-=Math.abs(t),this.velocity.y=Math.max(0,this.velocity.y)):this.velocity.y<0&&(this.velocity.y+=Math.abs(t),this.velocity.y=Math.min(0,this.velocity.y))}onMount(){}update(t){this.node.tranPositionX(this.velocity.x*t/1e3),this.node.tranPositionY(this.velocity.y*t/1e3)}draw(t){}}class F extends w{constructor(){super(),this.animations={},this.scale=new o(1,1),this.flap=new o(1,1)}setScale(t){this.scale=t,this.curAnimation&&this.curAnimation.setScale(t)}setFlap(t){this.flap=t,this.curAnimation&&this.curAnimation.setFlap(t)}onMount(){for(var t in this.animations)!this.animations[t].hasMounted()&&this.animations[t].setNode(this.node)}addAnimationWithData(t){var e=S.createWithData(t);this.hasMounted()&&!e.hasMounted()&&e.setNode(this.node),this.animations[t.name]=e}playAnaimtion(t){this.curAnimation=this.animations[t],this.curAnimation.play(),this.curAnimation.setScale(this.scale),this.curAnimation.setFlap(this.flap)}setScaleX(t){}update(t){this.curAnimation&&this.curAnimation.update(t)}draw(t){this.curAnimation&&this.curAnimation.draw(t)}}class N extends h{constructor(){super(),this.gavity=60,this.size.width=100,this.size.height=100,this.position.x=400,this.position.y=300,this.anchor.x=.5,this.anchor.y=0;var t=new A;t.setMover(new H),t.setRect(new C(0,0,100,100)),t.setGavity(this.gavity),t.setGround(500),t.setJumpSpeed(-1e3),t.setWalkSpeed(500),t.setWalkAcc(50),this.actor2d=this.addComponent(t),this.animator=this.addComponent(new F),this.animator.addAnimationWithData({name:"genji_standing",loop:0,duration:120,image:"../textures/template.png",frames:[{rect:{x:0,y:0,width:79,height:79}},{rect:{x:80,y:0,width:79,height:79}},{rect:{x:160,y:0,width:79,height:79}},{rect:{x:240,y:0,width:79,height:79}}]}),this.animator.addAnimationWithData({name:"genji_walking",loop:0,duration:60,image:"../textures/template.png",frames:[{rect:{x:0,y:160,width:79,height:79}},{rect:{x:80,y:160,width:79,height:79}},{rect:{x:160,y:160,width:79,height:79}},{rect:{x:80,y:160,width:79,height:79}}]}),this.animator.playAnaimtion("genji_standing")}jump(){this.actor2d.jump()}walk(t){t?(this.animator.playAnaimtion("genji_walking"),this.animator.flap.x=t):this.animator.playAnaimtion("genji_standing"),this.actor2d.walk(t)}}const X=C,Y=o,z=h,P=class extends h{constructor(){super();var t=l.getInstance().getSize();this.setWidth(t.width),this.setHeight(t.height)}goto(t){a.getInstance().push(new t)}},K=class extends w{constructor(){super(),this.items=[],this.isDirty=!0}add(t){return this.items.push(t),t}remove(t){for(var e=0;e<this.items.length;++e)if(this.items[e]===t){this.items.splice(e,1);break}}onMount(){}draw(t){this.isDirty=!1;var e=this.node.getAnchorOffset();this.items.map(i=>{var{fill:s,stroke:n,fillStyle:o,strokeStyle:r,width:h,close:a,style:c,type:u}=i;switch(t.fillStyle=o||"transparent",t.strokeStyle=r||"gray",t.lineWidth=h||1,t.beginPath(),u){case"lines":var{points:l}=i;l.map((i,s)=>{0===s?t.moveTo(i.x-e.x,i.y-e.y):t.lineTo(i.x-e.x,i.y-e.y)}),n&&t.stroke();break;case"rect":var{x:d,y:p,w:y,h:m}=i;n&&t.strokeRect(d-e.x,p-e.y,y,m),s&&t.fillRect(d-e.x,p-e.y,y,m);break;case"circle":var{x:d,y:p,r:g}=i;t.arc(d-e.x,p-e.y,g,0,2*Math.PI),n&&t.stroke(),s&&t.fill()}a&&t.closePath()})}},R=x,B=H,W=class extends w{constructor(){super()}onMount(){}_initKeyboard(){this.isListeningKeyboard||(this.isListeningKeyboard=!0,y.getInstance().addListener("keydown",this._onKeyDown.bind(this),!1),y.getInstance().addListener("keyup",this._onKeyUp.bind(this),!1),this.foucsingKeys={},this.plisteners={},this.klisteners={},this.rlisteners={},this.dklisteners={})}_onKeyDown(t){"number"==typeof this.foucsingKeys[t.key]&&this.foucsingKeys[t.key]<1&&(this.foucsingKeys[t.key]=1)}_onKeyUp(t){"number"==typeof this.foucsingKeys[t.key]&&this.foucsingKeys[t.key]>0&&(this.foucsingKeys[t.key]=0)}onKeyPress(t,e){this._initKeyboard(),this.foucsingKeys[t]=0,this.plisteners[t]=e}onKeyRelease(t,e){this._initKeyboard(),this.foucsingKeys[t]=0,this.rlisteners[t]=e}onKeyKeepPress(t,e){this._initKeyboard(),this.foucsingKeys[t]=0,this.klisteners[t]=e}onDirectionKeepPress(t,e,i){this._initKeyboard(),this.foucsingKeys[t]=0,this.foucsingKeys[e]=0,this.dklisteners[t+"_"+e]=i}update(t){if(this.isListeningKeyboard){for(var e in this.dklisteners){var i=e.split("_");this.dklisteners[e](this.foucsingKeys[i[1]]-this.foucsingKeys[i[0]],t)}for(var e in this.foucsingKeys)if(this.foucsingKeys[e])switch(this.foucsingKeys[e]){case 0:this.foucsingKeys[e]--,this.rlisteners[e]&&this.rlisteners[e](t);break;case 1:this.foucsingKeys[e]++,this.plisteners[e]&&this.plisteners[e](t);break;case 2:this.klisteners[e]&&this.klisteners[e](t)}}}};var U=document.getElementById("app"),j=document.createElement("canvas");U.appendChild(j),l.getInstance().launch(j).setSize(1366,768).setBackgroundColor("black"),y.getInstance().launch(),m.getInstance().launch(),a.getInstance().run(new class extends P{constructor(){super(),this.gavity=60,this.speedY=0,this.pressUp=0,this.pressDown=0,this.pressRight=0,this.pressLeft=0,this.pressJump=0,this.pressAttack=0,this.pressFn=0,this.ud=0,this.lr=0,this.playerFace=1}onUpdate(t){}createBullet(t){var e=new z;e.setSizeWH(25,25),e.setPosition(this.player.getPosition()),e.addComponent(new R("../../textures/moon_1024.jpg"));var i=e.addComponent(new B);i.tranVelocityX(1600*Math.sin(t)),i.tranVelocityY(1600*Math.cos(t)),e.addAction(new f(1e4,1e4)),console.log(e),this.addChild(e)}getShotAngle(){var t=this.ud,e=this.lr,i=90;return 1==e?1==t?i-=45:-1==t&&(i+=45):-1==e?(i=-90,1==t?i+=45:-1==t&&(i-=45)):1==t?i=0:-1==t&&(i=180),i}rightShot(){var t=this.getShotAngle();this.createBullet((t+10)*Math.PI/180),this.createBullet(t*Math.PI/180),this.createBullet((t-10)*Math.PI/180),setTimeout(()=>{this.shotting=!1},500)}leftShot(){this.count=this.count||0,this.count++;var t=this.getShotAngle();this.createBullet(t*Math.PI/180),this.count<3?setTimeout(this.leftShot.bind(this),100):setTimeout(()=>{this.shotting=!1,this.count=0},500)}onAdded(){this.stage2D=new z;var t,e=this.stage2D.addComponent(new K),i=new X(0,600,1e3,100),s=new X(10,610,900,50),n=i.intersectWith(s);e.add({type:"lines",stroke:!0,fill:!0,width:1,points:[new Y(0,0),new Y(100,100),new Y(100,0)]}),e.add({color:"#FF0000",style:"stroke",type:"rect",x:i.x,y:i.y,w:i.w,h:i.h}),e.add({color:"#FF0000",style:"stroke",type:"rect",x:s.x,y:s.y,w:s.w,h:s.h}),n&&e.add({color:"#00FF00",style:"fill",type:"rect",x:n.x,y:n.y,w:n.w,h:n.h}),this.addChild(this.stage2D),this.genji=this.addChild(new N),this.buttonLayer=new z,this.buttonLayer.setPositionXY(300,0),(t=new L("Sprite & Action")).setPositionXY(400,300),this.buttonLayer.addChild(t),(t=new L("Button")).setPositionXY(400,350),t.onMouseUp=(()=>{this.setScaleXY(.8*this.getScaleX(),1)}),this.buttonLayer.addChild(t),this.addChild(this.buttonLayer),this.player=new z,this.player.setSizeWH(100,100),this.player.setPositionXY(400,300),this.player.anchor={x:.5,y:0};var o=new A;o.setMover(new B),o.setRect(new X(0,0,100,100)),o.setGavity(this.gavity),o.setGround(500),o.setJumpSpeed(-1e3),o.setWalkSpeed(500),o.setWalkAcc(50),console.log(this.player),this.actor2d=this.player.addComponent(o);var r=S.createWithData({name:"genji_standing",loop:0,duration:250,image:"../../textures/genji.jpg",frames:[{rect:{x:0,y:0,width:80,height:80}},{rect:{x:80,y:0,width:80,height:80}},{rect:{x:160,y:0,width:80,height:80}},{rect:{x:80,y:0,width:80,height:80}}]});r.play(),this.addChild(this.player),this.player.addComponent(r);var h=new z;h.setSizeWH(50,50),h.setPositionXY(50,50),h.addComponent(new R("../../textures/moon_1024.jpg")),h.setRotation(45),this.player.addChild(h);var a=this.addComponent(new W);a.onKeyPress("k",()=>this.genji.jump()),a.onDirectionKeepPress("w","s",(t,e)=>{t/=t?Math.abs(t):1,this.ud=t}),a.onDirectionKeepPress("a","d",(t,e)=>{t/=t?Math.abs(t):1,this.lr=t,this.playerFace=t,this.genji.walk(t)}),a.onKeyPress("l",()=>{this.pressFn=1}),a.onKeyRelease("l",()=>{this.pressFn=1}),a.onKeyKeepPress("j",()=>{this.shotting||(this.shotting=!0,1==this.pressFn?this.rightShot():this.leftShot())})}onRemoved(){}})}]);